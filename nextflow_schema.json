{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://raw.githubusercontent.com/rmcolq/pantheon/main/nextflow_schema.json",
  "title": "rmcolq/pantheon",
  "description": "Metagenomic binning of single reads from both amplicon-targeted and shotgun metagenomics sequencing.",
  "url": "https://github.com/rmcolq/pantheon",
  "type": "object",
  "definitions": {
    "input_options": {
      "title": "Input Options",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Define where the pipeline should find input data and save output data.",
      "properties": {
        "run_dir": {
          "type": "string",
          "format": "path",
          "title": "Run directory",
          "required": true,
          "description": "A directory containing a directory of fastq for a each barcode in a run.",
          "help_text": "This should be in the ONT run output, e.g. the `fastq_pass` subdirectory.",
          "demo_data": "test/test_data/"
        },
        "wf_dir": {
          "type": "string",
          "format": "path",
          "title": "Workflow directory",
          "required": true,
          "description": "A directory containing the output and work subdirectories generated by wf-metagenomics.",
          "help_text": "This can be found by looking at the Parameters section for the run in EPI2ME."
        },
        "unique_id": {
          "type": "string",
          "title": "The unique ID for this sample or run",
          "description": "This is used to name the final report and directory of summary outputs."
        }
      },
      "allOf":
      [
        {
          "required":
          [
            "run_dir",
            "wf_dir"
          ]
        }
      ]
    },
    "parameter_options": {
      "title": "Parameter Options",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Define the taxa to be extracted and the thresholds for extraction and assembly.",
      "properties": {
        "taxon_names": {
          "type": "string",
          "title": "Taxon Names",
          "required": true,
          "description": "A comma separated list of taxon names to be extracted and assembled.",
          "help_text": "A comma separated list of taxon names to be extracted and assembled. These should have quotation marks around each item."
        },
        "max_human_reads_before_rejection": {
          "type": "integer",
          "default": 10000,
          "title": "Max human reads before sample rejection",
          "description": "Threshold for the maximum number of human reads permitted in a sample before it is rejected.",
          "help_text": "Threshold for the maximum number of human reads permitted in a sample before it is rejected."
        },
        "extract_rank": {
          "type": "string",
          "default": "S G",
          "title": "Taxon ranks to be extracted",
          "description": "Only taxa at these ranks will have reads extracted (S1 would be extracted if rank S).",
          "help_text": "Only taxa at these ranks will have reads extracted (S1 would be extracted if rank S)."
        },
        "extract_min_reads": {
          "type": "integer",
          "default": 1,
          "title": "Min reads for extraction",
          "description": "Minimum number of reads of a taxon in a sample for a read subset to be extracted.",
          "help_text": "Minimum number of reads of a taxon in a sample for a read subset to be extracted."
        },
        "reference_min_count": {
          "type": "integer",
          "default": 10,
          "title": "Min read count for assembly",
          "description": "Minimum read count of a taxon for reference guided assembly to be attempted.",
          "help_text": "Minimum read count of a taxon for reference guided assembly to be attempted. Note that if this is too low, the result output will be unreliable."
        },
        "reference_sequence_sep": {
          "type": "string",
          "default": "NNNNNNNNNNNNNNNNNNNNNNNNNNNNNN",
          "title": "Segment seperator",
          "description": "String to separate segmented genomes parts within the reference (and assembly).",
          "help_text": "String to separate segmented genomes parts within the reference (and assembly)."
        }
      },
      "allOf":
      [
        {
          "required":
          [
            "taxon_names"
          ]
        }
      ]
    },
    "output_options": {
      "title": "Output Options",
      "type": "object",
      "description": "Parameters for saving and naming workflow outputs.",
      "properties": {
        "outdir": {
          "type": "string",
          "format": "directory-path",
          "default": "output",
          "title": "Output folder name",
          "description": "Directory for output of all user-facing files."
        }
      }
    },
    "user_options": {
      "title": "User Options",
      "type": "object",
      "description": "Parameters specifying user credentials for interacting with NCBI ENTREZ DIRECT.",
      "properties": {
        "ncbi_api_key": {
          "type": "string",
          "required": true,
          "title": "API key generated by the user",
          "description": "NCBI api key generated described in https://ncbiinsights.ncbi.nlm.nih.gov/2017/11/02/new-api-keys-for-the-e-utilities/."
        },
        "email": {
          "type": "string",
          "default": "email@ed.ac.uk",
          "title": "Email address of user",
          "description": "This field is currently only used for NCBI entrez direct queries and has to look like a real email."
        }
      },
      "allOf":
      [
        {
          "required":
          [
            "ncbi_api_key"
          ]
        }
      ]
    },
    "advanced_options": {
      "title": "Advanced Options",
      "type": "object",
      "description": "Advanced options for configuring processes inside the workflow.",
      "default": "",
      "properties": {
        "local": {
          "type": "boolean",
          "default": true,
          "title": "Use lower resources appropriate for local computer",
          "description": "Maximum number of CPU threads to use per workflow task.",
          "help_text": "This workflow will request HPC level resources unless this is checked."
        },
        "threads": {
          "type": "integer",
          "default": 2,
          "title": "Maximum number of CPU threads",
          "description": "Maximum number of CPU threads to use per workflow task.",
          "help_text": "Several tasks in this workflow benefit from using multiple CPU threads. This option sets the number of CPU threads for all such processes. The total CPU resource used by the workflow is constrained by the executor configuration. See server threads parameter for kraken specific threads."
        }
      }
    },
    "miscellaneous_options": {
      "title": "Miscellaneous Options",
      "type": "object",
      "fa_icon": "fas fa-file-import",
      "description": "Everything else.",
      "help_text": "These options are common to all nf-core pipelines and allow you to customise some of the core preferences for how the pipeline runs.\n\nTypically these options would be set in a Nextflow config file loaded for all pipeline runs, such as `~/.nextflow/config`.",
      "properties": {
        "help": {
          "type": "boolean",
          "title": "Display help text",
          "fa_icon": "fas fa-question-circle",
          "hidden": true
        },
        "version": {
          "type": "boolean",
          "title": "Display version",
          "description": "Display version and exit.",
          "fa_icon": "fas fa-question-circle",
          "hidden": true
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "#/definitions/input_options"
    },
    {
      "$ref": "#/definitions/parameter_options"
    },
    {
      "$ref": "#/definitions/output_options"
    },
    {
      "$ref": "#/definitions/user_options"
    },
    {
      "$ref": "#/definitions/advanced_options"
    },
    {
      "$ref": "#/definitions/miscellaneous_options"
    }
  ],
  "properties": {
    "aws_image_prefix": {
      "type": "string",
      "title": "AWS image prefix",
      "hidden": true
    },
    "aws_queue": {
      "type": "string",
      "title": "AWS queue",
      "hidden": true
    },
    "monochrome_logs": {
      "type": "boolean"
    },
    "validate_params": {
      "type": "boolean",
      "default": true
    },
    "show_hidden_params": {
      "type": "boolean"
    }
  },
  "docs": {
    "intro": "\n## Introduction\n\npantheon allows metagenomic reads to be binned by taxa and assembled: See quickstart below for more details.\n\n",
    "links": "## Useful links\n\n* [nextflow](https://www.nextflow.io/)\n* [docker](https://www.docker.com/products/docker-desktop)"
  }
}
